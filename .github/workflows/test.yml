name: Test workflow
on: [workflow_dispatch]

jobs:
  test-job:
    runs-on: ubuntu-latest
    name: Test job
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: ntfy-action test step
        uses: ./
        with:
          url: ${{ secrets.NTFY_URL }}
          topic: ${{ secrets.NTFY_TOPIC }}
          icon: 'https://github.githubassets.com/images/modules/profile/achievements/starstruck-default.png'
          default: '{"title": "The default title", "message": "The default message"}'
          job_status: ${{ job.status }}

      - name: ntfy-action test step
        uses: ./
        with:
          url: ${{ secrets.NTFY_URL }}
          topic: ${{ secrets.NTFY_TOPIC }}
          icon: 'https://github.githubassets.com/images/modules/profile/achievements/starstruck-default.png'
          default: '{"title": "The default title", "message": "The default message", "tags": ["white_check_mark"]}'
          on_failure: ${{ format('{{"title":"{0}","message":"Workflow run {1} has failed","priority":4,"tags":["x"]}}', github.repository, github.workflow) }}
          job_status: 'failure'